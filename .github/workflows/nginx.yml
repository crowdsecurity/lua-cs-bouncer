name: lua ca bouncer nginx test

on:
  push:
    branches:
      - main
      - releases/**
  pull_request:
    branches:
      - main
      - releases/**


jobs:
  tests:
    name: "Nginx test suite"
    runs-on: ubuntu-latest
    steps:
    - name: Check out repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
        submodules: false
    - name: "install nginx & nginx perl test suite"
      run: |
        sudo cpan Test::Nginx
        sudo apt-get install -y nginx
    - name: "run tests"
      run: |
        for i in t/*.t; do
           sudo prove $i ;
        done
